{% extends 'home/components/layout.html.twig' %}

{% block title %} Project Kakarot - Perfil{% endblock %}

{% block content %}

{% for flash_message in app.session.flashbag.get('danger') %}
    <div class="alert dangerAlert" role="alert">{{ flash_message }}</div>
{% endfor %}

{% for flash_message in app.session.flashbag.get('success') %}
    <div class="alert successAlert" role="alert">{{ flash_message }}</div>
{% endfor %}

<div class="caja" style="gap:50px;padding:20px;width:fit-content;margin:auto;margin-top:50px;height:500px;">
    <div style="height:305px;" class="settingsForm">
        <div style="padding-left:20px;border-bottom-left-radius:unset;border-bottom-right-radius:unset;" class="container2">
            <div class="emailSettings">
                <h3>Datos Personales</h3>
                <p>Nombre de Usuario: {{ app.user.username}}</p>
                <p>Email: {{ app.user.email}}</p>
                <p>Registrado el día: {{ app.user.createdAt|date('d-m-Y')  }}</p>
            </div>
        </div>

        <div style="padding-left:20px;padding-right:20px;padding-bottom:20px;border-top-left-radius:unset;border-top-right-radius:unset;height:inherit;" class="container2">
            {{ form_start(settingsForm) }}
                <h3>Editar Perfil</h3>
                {{ form_row(settingsForm.username) }}
                <div style="margin:auto;padding-bottom:20px;padding-top:20px;" class="avatar-wrapper" data-tippy-placement="bottom" title="Cambiar Avatar">
                    {% if user.avatar is not null %}
                        <img class="profile-pic" src="/img/avatars/{{ user.avatar }}" alt="" />
                    {% else %}
                        <img class="profile-pic" src="/img/default-avatar.svg" alt="" />
                    {% endif %}
                    <div class="upload-button"></div>
                    {{ form_widget(settingsForm.avatar, {'attr':{'class':'file-upload'}})}}
                </div>
            <button style="display:flex;margin:auto;" type="submit" class="Btn btnSecondary">GUARDAR CAMBIOS</button>
            {{ form_end(settingsForm) }}
        </div>
    </div>

<div class="gridContainer">
    <div style="padding-left:20px;padding-right:20px;height:100px;padding-bottom:20px;" id="gridInContainer1" class="container2">
        <div class="emailVerification">
            {% if user.isVerified == false %}
                <div>
                    <h3>Reenviar Verificación de Email</h3>
                    <button onclick=window.location.href="{{ path('app_account_emailVerify')}}" class="Btn btnPrimary" title="Reenviar Verificación de Email">REENVIAR</button>
                </div>
            {% endif %}
        </div>
    </div>

    <div style="padding-left:20px;padding-right:20px;height:100px;padding-bottom:20px;" id="gridInContainer2" class="container2">
        <div class="security">
            <h3>Seguridad</h3>
            <a href="{{ path('app_forgot_password_request') }}" class="Btn btnSecondary" type="button">CAMBIAR CONTRASEÑA</a>
            <a id="buttonDeleteAccount" class="Btn btnDanger" href="#deleteAccount" type="button">ELIMINAR CUENTA</a>
        </div>
    </div>

    <div style="padding-left:20px;padding-right:20px;padding-bottom:20px;" class="container2" id="gridInContainer3">
        <div class="rewards">
            <h3>Mis Recompensas</h3>
        </div>
    </div>
</div>
    <div id="myModal" class="modal">
        <div class="modal-content" id="#deleteAccount">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Confirmación de eliminación de cuenta</h2>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro que deseas eliminar tu cuenta?</p>
                <p>Perderás todos tus datos.</p>
            </div>
            <a class="Btn btnDanger" href="{{ path('app_account_delete')}}">CONFIRMAR</a>
        </div>
    </div>
</div>
    
{% endblock %}

{% block javascripts %}
{{ parent() }}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>

    var modal = document.getElementById("myModal");
    var btn = document.getElementById("buttonDeleteAccount");
    var span = document.getElementsByClassName("close")[0];

    btn.onclick = function() {
        modal.style.display = "block";
    }

    span.onclick = function() {
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    function avatarSwitcher() {
	    var readURL = function(input) {
	        if (input.files && input.files[0]) {
	            var reader = new FileReader();

	            reader.onload = function (e) {
	                $('.profile-pic').attr('src', e.target.result);
	            };
	    
	            reader.readAsDataURL(input.files[0]);
	        }
	    };
	   
	    $(".file-upload").on('change', function(){
	        readURL(this);
	    });
	    
	    $(".upload-button").on('click', function() {
	       $(".file-upload").click();
	    });
	} avatarSwitcher();

</script>

{% endblock %}
